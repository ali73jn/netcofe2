<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <title>تست JSON</title>
    <style>
        body { font-family: Tahoma; padding: 20px; }
        .test-area { margin: 20px 0; padding: 20px; background: #f5f5f5; }
        button { margin: 5px; padding: 10px; background: #007bff; color: white; border: none; cursor: pointer; }
        #output { margin-top: 20px; padding: 15px; background: white; border: 1px solid #ddd; }
    </style>
</head>
<body>
    <h2>تست ساختار JSON</h2>
    
    <div class="test-area">
        <button onclick="testCategorize()">تست دسته‌بندی</button>
        <button onclick="testGetLevel()">تست سطح‌ها</button>
        <button onclick="testNavigation()">تست ناوبری</button>
    </div>
    
    <div id="output"></div>
    
    <script>
        // JSON نمونه (مشابه داده‌های شما)
        const sampleData = [
            {
                id: '359',
                title: 'سایت های پرکاربرد',
                type: 'folder',
                children: [
                    { id: '604', title: 'عدل ایران', type: 'bookmark', url: 'https://adliran.ir/' },
                    { id: '435', title: 'سایر', type: 'folder', children: [
                        { id: '178', title: 'قبضینو', type: 'bookmark', url: 'https://ghabzino.com/' }
                    ]}
                ]
            },
            {
                id: '317',
                title: 'ابزار ها',
                type: 'folder',
                children: [
                    { id: '321', title: 'pdf', type: 'folder', children: [] }
                ]
            }
        ];
        
        function log(msg) {
            document.getElementById('output').innerHTML += msg + '<br>';
            console.log(msg);
        }
        
        function testCategorize() {
            log('=== تست دسته‌بندی ===');
            
            const categories = {};
            sampleData.forEach(item => {
                if (item.type === 'folder') {
                    categories[item.title] = [item];
                    log(`دسته‌بندی: ${item.title}`);
                }
            });
            
            log(`تعداد دسته‌ها: ${Object.keys(categories).length}`);
        }
        
        function testGetLevel() {
            log('=== تست دریافت سطح ===');
            
            // حالت ریشه
            log('حالت ریشه:');
            sampleData.forEach(item => {
                if (item.type === 'folder') {
                    log(`  - ${item.title}: ${item.children?.length || 0} آیتم`);
                }
            });
            
            // حالت داخل پوشه
            log('حالت داخل پوشه "سایت های پرکاربرد":');
            const siteFolder = sampleData.find(item => item.title === 'سایت های پرکاربرد');
            if (siteFolder && siteFolder.children) {
                siteFolder.children.forEach(child => {
                    log(`  - ${child.title} (${child.type})`);
                });
            }
        }
        
        function testNavigation() {
            log('=== تست ناوبری ===');
            
            // شبیه‌سازی مسیر
            const currentPath = ['435']; // وارد پوشه "سایر" شده‌ایم
            
            log(`مسیر: ${currentPath}`);
            
            // پیدا کردن پوشه اصلی
            const rootFolder = sampleData.find(item => item.title === 'سایت های پرکاربرد');
            
            if (rootFolder) {
                log(`پوشه ریشه: ${rootFolder.title}`);
                
                // حرکت در مسیر
                let currentLevel = rootFolder.children || [];
                
                currentPath.forEach(folderId => {
                    const folder = currentLevel.find(item => item.id === folderId);
                    if (folder) {
                        log(`  ↪️ وارد پوشه: ${folder.title}`);
                        currentLevel = folder.children || [];
                    }
                });
                
                log(`آیتم‌های سطح فعلی: ${currentLevel.length} آیتم`);
                currentLevel.forEach(item => {
                    log(`    • ${item.title} (${item.type})`);
                });
            }
        }
        
        log('برنامه تست آماده است.');
    </script>
</body>
</html>