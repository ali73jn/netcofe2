<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù‡Ù…ÛŒØ§Ø± Ú©Ø§ÙÛŒÙ†Øª - NetCofe Dashboard</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#007bff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="assets/icons/default_icon.png">
    <link rel="apple-touch-icon" href="assets/icons/icon-192.png">
    
    <!-- Manifest -->
    <link rel="manifest" href="manifest.webmanifest">
    
    <!-- Styles -->
    <link rel="stylesheet" href="assets/css/dashboard.css">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tahoma:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    
    <!-- Ø¢ÙÙ„Ø§ÛŒÙ† Ø§ÛŒÙ†Ø¯ÛŒÚ©ÛŒØªÙˆØ± -->
    <div id="offline-indicator" class="offline-indicator hidden">
        ğŸ”Œ Ø­Ø§Ù„Øª Ø¢ÙÙ„Ø§ÛŒÙ†
    </div>
    
    <!-- Ú©Ø§Ù†ØªÛŒÙ†Ø± Ø§ØµÙ„ÛŒ -->
    <main id="grid-container">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p>Ø¯Ø± Ø­Ø§Ù„ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù‡Ù…ÛŒØ§Ø± Ú©Ø§ÙÛŒÙ†Øª...</p>
        </div>
    </main>

    <!-- Ù…Ù†ÙˆÛŒ Ú©Ù†ØªØ±Ù„ -->
    <div id="control-menu">
        <div id="sub-controls" class="hidden-controls">
            <button id="add-card-btn" class="sub-btn" title="Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Øª Ø¬Ø¯ÛŒØ¯">â•</button>
            <button id="refresh-bookmarks-btn" class="sub-btn" title="Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¨ÙˆÚ©Ù…Ø§Ø±Ú©â€ŒÙ‡Ø§">ğŸ”„</button>
            <button id="set-background-btn" class="sub-btn" title="Ø§Ù†ØªØ®Ø§Ø¨ Ù¾Ø³ Ø²Ù…ÛŒÙ†Ù‡">ğŸ–¼ï¸</button>
            <button id="toggle-theme-btn" class="sub-btn" title="ØªØºÛŒÛŒØ± Ø­Ø§Ù„Øª ØªØ§Ø±ÛŒÚ©/Ø±ÙˆØ´Ù†">ğŸŒ“</button>
            <button id="export-bookmarks-btn" class="sub-btn" title="Ø®Ø±ÙˆØ¬ÛŒ Ø¨ÙˆÚ©Ù…Ø§Ø±Ú©â€ŒÙ‡Ø§">ğŸ”–ğŸ“¤</button>
            <button id="import-bookmarks-btn" class="sub-btn" title="ÙˆØ±ÙˆØ¯ Ø¨ÙˆÚ©Ù…Ø§Ø±Ú©â€ŒÙ‡Ø§">ğŸ”–ğŸ“¥</button>
            <button id="export-settings-btn" class="sub-btn" title="Ø®Ø±ÙˆØ¬ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª">âš™ï¸ğŸ“¤</button>
            <button id="import-settings-btn" class="sub-btn" title="ÙˆØ±ÙˆØ¯ ØªÙ†Ø¸ÛŒÙ…Ø§Øª">âš™ï¸ğŸ“¥</button>
            <button id="search-btn" class="sub-btn" title="Ø¬Ø³ØªØ¬Ùˆ">ğŸ”</button>
        </div>
        
        <button id="edit-mode-btn" class="main-btn" title="Ø­Ø§Ù„Øª ÙˆÛŒØ±Ø§ÛŒØ´">âœï¸</button>
    </div>
    
    <!-- InputÙ‡Ø§ÛŒ ÙØ§ÛŒÙ„ Ù…Ø®ÙÛŒ -->
    <input type="file" id="import-settings-file" accept=".json" style="display: none;">
    <input type="file" id="import-bookmarks-file" accept=".json" style="display: none;">
    <input type="file" id="background-file-input" accept="image/*" style="display: none;">

    <!-- Modal Ù…Ø¯ÛŒØ±ÛŒØª Ø¨ÙˆÚ©Ù…Ø§Ø±Ú© -->
    <div id="bookmark-modal" class="modal-overlay hidden">
        <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ù…Ø¯Ø§Ù„... -->
    </div>
    
    <!-- Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø§ØµÙ„ÛŒ -->
    <script>
        // Ø§ÙˆÙ„ ÛŒÚ© ØªØ³Øª Ø³Ø§Ø¯Ù‡ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ¯ÛŒÙ…
        console.log('ğŸš€ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø´Ø±ÙˆØ¹ Ø´Ø¯');
        
        // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ù„ÙˆØ¯ÛŒÙ†Ú¯
        function showLoading(msg) {
            const container = document.getElementById('grid-container');
            if (container) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 50px;">
                        <div class="spinner"></div>
                        <p style="margin-top: 20px;">${msg}</p>
                    </div>
                `;
            }
        }
        
        // ØªØ³Øª Ø¢Ø¯Ø±Ø³ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
        async function testFiles() {
            const tests = [
                { name: 'CSS', url: 'assets/css/dashboard.css' },
                { name: 'JS', url: 'assets/js/dashboard.js' },
                { name: 'Manifest', url: 'manifest.webmanifest' },
                { name: 'Bookmarks', url: 'assets/data/bookmarks.json' }
            ];
            
            for (const test of tests) {
                try {
                    const response = await fetch(test.url);
                    console.log(`${test.name}: ${response.ok ? 'âœ…' : 'âŒ'} (${response.status})`);
                } catch (error) {
                    console.log(`${test.name}: âŒ ${error.message}`);
                }
            }
        }
        
        // Ù„ÙˆØ¯ Ú©Ø±Ø¯Ù† Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø§ØµÙ„ÛŒ
        function loadApp() {
            showLoading('Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†...');
            
            const script = document.createElement('script');
            script.src = 'assets/js/dashboard.js';
            script.onload = function() {
                console.log('âœ… dashboard.js Ù„ÙˆØ¯ Ø´Ø¯');
                
                // 2 Ø«Ø§Ù†ÛŒÙ‡ ØµØ¨Ø± Ú©Ù† Ø³Ù¾Ø³ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø±Ùˆ Ø´Ø±ÙˆØ¹ Ú©Ù†
                setTimeout(() => {
                    if (window.App && typeof window.App.init === 'function') {
                        window.App.init().catch(e => {
                            console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± init:', e);
                            showLoading(`Ø®Ø·Ø§: ${e.message}<br><button onclick="location.reload()">ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯</button>`);
                        });
                    } else {
                        showLoading('App.init Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯. Ù„Ø·ÙØ§ ØµÙØ­Ù‡ Ø±Ø§ Ø±ÙØ±Ø´ Ú©Ù†ÛŒØ¯.');
                    }
                }, 2000);
            };
            
            script.onerror = function() {
                console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ù„ÙˆØ¯ Ú©Ø±Ø¯Ù† dashboard.js');
                showLoading('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ.<br>Ù„Ø·ÙØ§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯ Ú©Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø¢Ù¾Ù„ÙˆØ¯ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ù†Ø¯.');
            };
            
            document.body.appendChild(script);
        }
        
        // Ø´Ø±ÙˆØ¹ Ø¨Ø±Ù†Ø§Ù…Ù‡
        window.addEventListener('DOMContentLoaded', function() {
            console.log('âœ… DOM Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª');
            showLoading('Ø¨Ø±Ø±Ø³ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§...');
            
            // Ø§ÙˆÙ„ ØªØ³Øª Ú©Ù†
            testFiles().then(() => {
                // Ø³Ù¾Ø³ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø±Ùˆ Ù„ÙˆØ¯ Ú©Ù†
                loadApp();
            });
        });
        
        // Ø§Ú¯Ø± DOM Ø§Ø² Ù‚Ø¨Ù„ Ù„ÙˆØ¯ Ø´Ø¯Ù‡
        if (document.readyState !== 'loading') {
            showLoading('Ø´Ø±ÙˆØ¹ Ø¨Ø±Ù†Ø§Ù…Ù‡...');
            testFiles().then(loadApp);
        }
    </script>
</body>
</html>
